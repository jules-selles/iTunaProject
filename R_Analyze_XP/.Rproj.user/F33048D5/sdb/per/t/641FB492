{
    "contents" : "\ndir.data           <- \"C:/Users/jselles/Dropbox/These/These_Ifremer/Documents_Travail/Modele_XP/\"\ndir.script         <- \"Xp_protocole/R_scripts/\" \ndir.xp             <- \"demo_data/\"\ndo.save=TRUE\n\n## Packages/functions \n\nlibrary(gridExtra)\nlibrary(grid)\nlibrary(ggplot2)\nlibrary(lattice)\nrequire(reshape2)\n\n\n## get Profit, schaefer etc. functions \nsource(paste(dir.data,dir.script,\"Xp_calculus.R\",sep=\"\"))\n\nsource(paste(dir.data,dir.script,\"read_Otree.R\",sep=\"\"))\nsource(paste(dir.data,dir.script,\"makeTable_Otree.R\",sep=\"\"))\n\n## save plot \n\npath.fig= paste(dir.data,dir.xp,sep=\"\")\n\n\n#-----------------------------------------\n## Make data frame with all sessions\n#-----------------------------------------\n\n##--------------------------------------------------\n## Session: mcd29yv0 / Group demo / p1 T0 / Ceresa,Bazin,Feuilloley / -> BUG biomass  ~ total catch\n\nxpdemo_data=extract_Otree_data(paste(dir.data,dir.xp,sep=\"\"),\"Xp1p1_T0_demo.csv\")\nxpdemo_data=as.data.frame(xpdemo_data)\nxp_mcd29yv0 = make.table.Otree(xp.data=xpdemo_data, session=\"mcd29yv0\", name=c(\"ceresa\",\"bazin\",\"feuilloley\"),\n                               age=c(22,23,22), profession=c(\"student\",\"student\",\"student\"))\nxp_mcd29yv0$treatment = 'T0'\nxp_mcd29yv0$phase = 'p1'\n\n##--------------------------------------------------\n## Session: mcd29yv0 / Group demo / p2 T0 / Ceresa,Bazin,Feuilloley / -> BUG biomass  ~ total catch\n\nxpdemo_data=extract_Otree_data(paste(dir.data,dir.xp,sep=\"\"),\"Xp1p2_T0_demo.csv\")\nxpdemo_data=as.data.frame(xpdemo_data)\nxp2_mcd29yv0 = make.table.Otree(xp.data=xpdemo_data, session=\"mcd29yv0\", name=c(\"ceresa\",\"bazin\",\"feuilloley\"),\n                               age=c(22,23,22), profession=c(\"student\",\"student\",\"student\"))\nxp2_mcd29yv0$treatment = 'T0'\nxp2_mcd29yv0$phase = 'p2'\n\n##--------------------------------------------------\n## Session: qkzbtj24 / Group demo / p2 T1 / Ceresa,Bazin,Feuilloley / -> BUG biomass  ~ total catch\n\nxpdemo_data=extract_Otree_data(paste(dir.data,dir.xp,sep=\"\"),\"Xp1p1_T1_demo.csv\")\nxpdemo_data=as.data.frame(xpdemo_data)\nxp_qkzbtj24 = make.table.Otree(xp.data=xpdemo_data, session=\"qkzbtj24\", name=c(\"girardot\",\"perez\",\"prim\"),\n                                age=c(22,23,22), profession=c(\"student\",\"student\",\"student\"))\nxp_qkzbtj24$treatment = 'T1'\nxp_qkzbtj24$phase = 'p1'\n\n##--------------------------------------------------\n## Session: qkzbtj24 / Group demo / p2 T1 / Ceresa,Bazin,Feuilloley / -> BUG biomass  ~ total catch\n\nxpdemo_data=extract_Otree_data(paste(dir.data,dir.xp,sep=\"\"),\"Xp1p2_T1_demo.csv\")\nxpdemo_data=as.data.frame(xpdemo_data)\nxp2_qkzbtj24 = make.table.Otree(xp.data=xpdemo_data, session=\"qkzbtj24\", name=c(\"girardot\",\"perez\",\"prim\"),\n                               age=c(22,23,22), profession=c(\"student\",\"student\",\"student\"))\nxp2_qkzbtj24$treatment = 'T1'\nxp2_qkzbtj24$phase = 'p2'\n\n\n##--------------------------------------------------\n## Session: qkzbtj24 / Group demo / p1 T2 / Ceresa,Bazin,Feuilloley / -> BUG biomass  ~ total catch\n\nxpdemo_data=extract_Otree_data(paste(dir.data,dir.xp,sep=\"\"),\"Xp1p1_T2_demo.csv\")\nxpdemo_data=as.data.frame(xpdemo_data)\nxp_d6svy5q9 = make.table.Otree(xp.data=xpdemo_data, session=\"d6svy5q9\", name=c(\"astrid\",\"soscian\",\"salvetat\"),\n                                age=c(22,23,22), profession=c(\"student\",\"student\",\"student\"))\nxp_d6svy5q9$treatment = 'T2'\nxp_d6svy5q9$phase = 'p1'\n\n##--------------------------------------------------\n## Session: qkzbtj24 / Group demo / p2 T2 / Ceresa,Bazin,Feuilloley / -> BUG biomass  ~ total catch\n\nxpdemo_data=extract_Otree_data(paste(dir.data,dir.xp,sep=\"\"),\"Xp1p2_T2_demo.csv\")\nxpdemo_data=as.data.frame(xpdemo_data)\nxp2_d6svy5q9 = make.table.Otree(xp.data=xpdemo_data, session=\"d6svy5q9\", name=c(\"astrid\",\"soscian\",\"salvetat\"),\n                               age=c(22,23,22), profession=c(\"student\",\"student\",\"student\"))\nxp2_d6svy5q9$treatment = 'T2'\nxp2_d6svy5q9$phase = 'p2'\n\n\n#--------------------------------------------------------------------------------------------\n## Plot by session \n#--------------------------------------------------------------------------------------------\nnb_xp=list(p1T0=xp_mcd29yv0,p2T0=xp2_mcd29yv0,p1T1=xp_qkzbtj24,p2T1=xp2_qkzbtj24,p1T2=xp_d6svy5q9,p2T2=xp2_d6svy5q9)\n\n\nfor (i in 1 : 6){\n##---------------------\n## rearrange to plot with ggplot \ngg=melt(nb_xp[[i]],id=c('participant_roundnumber','participant_id','participant_code','participant_appname',\n                                         'session_code','player_name', 'player_age', 'player_profession'))\n\n#-----------------\n## plot \n\n## Plot ind catch\n\nP_catch=ggplot(gg[which(gg$variable=='player_catchchoice'),], \n               aes(as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                   as.numeric(gg$value[which(gg$variable=='player_catchchoice')]),\n                   group=as.factor(gg$value[which(gg$variable=='player_id')]),\n                   colour=as.factor(gg$value[which(gg$variable=='player_id')])))\n\nP_catch =P_catch + geom_line()+ylim(0,15)+ xlim(0,15)+\n  scale_colour_discrete(name  =\"Coalitions\")+\n  ylab(\"Harvest (UVS)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n#+ geom_vline(aes(xintercept = 0,linetype = \"Nash\"), show.legend=FALSE) +scale_linetype_manual(values =c( \"Nash\" = \"dashed\")) +scale_colour_manual(values = c(\"Nash\"=\"black\"))\n\n\n## Plot ind catch pledge \n\nP_catchpledge=ggplot(gg[which(gg$variable=='player_catchpledge'),], \n                     aes(as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                         as.numeric(gg$value[which(gg$variable=='player_catchpledge')]),\n                         group=as.factor(gg$value[which(gg$variable=='player_id')]),\n                         colour=as.factor(gg$value[which(gg$variable=='player_id')])))\n\nP_catchpledge = P_catchpledge + geom_line()+ylim(0,15)+ xlim(0,15)+\n  scale_colour_discrete(name  =\"Coalitions\")+\n  ylab(\"Harvest pledge (UVS)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n#+ geom_vline(aes(xintercept = 0,linetype = \"Nash\"), show.legend=FALSE) +scale_linetype_manual(values =c( \"Nash\" = \"dashed\")) +scale_colour_manual(values = c(\"Nash\"=\"black\"))\n\n\n\n## Plot mean catch pledge\n\nP_meancatchpledge=ggplot(gg[which(gg$variable=='group_meancatchpledge'),], \n                         aes(x=as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                             y=as.numeric(gg$value[which(gg$variable=='group_meancatchpledge')])))\n\nlimits <- aes(ymax = nb_xp[[i]]$group_meancatchpledge + nb_xp[[i]]$group_sdcatchpledge, ymin= nb_xp[[i]]$group_meancatchpledge - nb_xp[[i]]$group_sdcatchpledge)\ndodge <- position_dodge(width=1)\n\nP_meancatchpledge = P_meancatchpledge + geom_line() +  geom_point(size=1.8) + geom_errorbar(limits,position=dodge, width=0.2,size=0.8)+ ylim(0,15)+ xlim(0,15)+\n  ylab(\"Mean Harvest Pledge (UVS)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n#+ geom_vline(aes(xintercept = 0,linetype = \"Nash\"), show.legend=FALSE) +scale_linetype_manual(values =c( \"Nash\" = \"dashed\")) +scale_colour_manual(values = c(\"Nash\"=\"black\"))\n\n\n## Plot total catch\n\nP_totalcatch=ggplot(gg[which(gg$variable=='group_totalcatch'),], \n                    aes(x=as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                        y=as.numeric(gg$value[which(gg$variable=='group_totalcatch')])))\n\nP_totalcatch =P_totalcatch + geom_line()+ylim(0,15)+ xlim(0,15)+\n  ylab(\"Total Harvest (UVS)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",axis.title=element_text(size=8))\n#+ geom_vline(aes(xintercept = 0,linetype = \"Nash\"), show.legend=FALSE) +scale_linetype_manual(values =c( \"Nash\" = \"dashed\")) +scale_colour_manual(values = c(\"Nash\"=\"black\"))\n\n\n## Plot mean catch\n\nP_meancatch=ggplot(gg[which(gg$variable=='group_meancatch'),], \n                   aes(x=as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                       y=as.numeric(gg$value[which(gg$variable=='group_meancatch')])))\n\nlimits <- aes(ymax = nb_xp[[i]]$group_meancatch + nb_xp[[i]]$group_sdcatch, ymin= nb_xp[[i]]$group_meancatch - nb_xp[[i]]$group_sdcatch)\ndodge <- position_dodge(width=1)\n\n\nP_meancatch = P_meancatch + geom_point(size=1.8) + geom_line()+  geom_errorbar(limits,position=dodge, width=0.2,size=0.8) + ylim(0,15)+ xlim(0,15)+\n  ylab(\"Mean Harvest (UVS)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n#+ geom_vline(aes(xintercept = 0,linetype = \"Nash\"), show.legend=FALSE) +scale_linetype_manual(values =c( \"Nash\" = \"dashed\")) +scale_colour_manual(values = c(\"Nash\"=\"black\"))\n\n\n## Plot ind profit\n\nP_profit=ggplot(gg[which(gg$variable=='player_profit'),], \n                aes(x=as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                    as.numeric(gg$value[which(gg$variable=='player_profit')]),\n                    group=as.factor(gg$value[which(gg$variable=='player_id')]),\n                    colour=as.factor(gg$value[which(gg$variable=='player_id')]),\n                    fill=as.factor(gg$value[which(gg$variable=='player_id')])))\n\nP_profit=P_profit + geom_line()+ylim(min(nb_xp[[i]]$player_profit,na.rm=TRUE),5)+ xlim(0,15)+\n  scale_colour_discrete(name  =\"Coalitions\")+\n  ylab(\"Profit (UVM)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n#+ geom_vline(aes(xintercept = 0,linetype = \"Nash\"), show.legend=FALSE) +scale_linetype_manual(values =c( \"Nash\" = \"dashed\")) +scale_colour_manual(values = c(\"Nash\"=\"black\"))\n\n\n## Plot mean profit\n\nP_meanprofit=ggplot(gg[which(gg$variable=='group_meanprofit'),], \n                    aes(x=as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                        y=as.numeric(gg$value[which(gg$variable=='group_meanprofit')])))\n\n\nlimits <- aes(ymax = nb_xp[[i]]$group_meanprofit + nb_xp[[i]]$group_sdprofit, ymin= nb_xp[[i]]$group_meanprofit - nb_xp[[i]]$group_sdprofit)\ndodge <- position_dodge(width=0.6)\n\n\nP_meanprofit = P_meanprofit + geom_point(size=1.8) + geom_line()+  geom_errorbar(limits,position=dodge, width=0.2,size=0.8) +\n  xlim(0,15)+ylim(-5,5)+\n  ylab(\"Mean Profit (UVM)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n#+ geom_vline(aes(xintercept = 0,linetype = \"Nash\"), show.legend=FALSE) +scale_linetype_manual(values =c( \"Nash\" = \"dashed\")) +scale_colour_manual(values = c(\"Nash\"=\"black\"))\n\n\n## Plot total profit\n\nP_totalprofit=ggplot(gg[which(gg$variable=='group_totalprofit'),], \n                     aes(x=as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                         y=as.numeric(gg$value[which(gg$variable=='group_totalprofit')])))\n\nP_totalprofit= P_totalprofit + geom_line()+ylim(min(nb_xp[[i]]$group_totalprofit,na.rm=TRUE),6)+ xlim(0,15)+\n  ylab(\"Total Profit (UVM)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n\n\n## Plot biomass\n\nP_biomasse=ggplot(gg[which(gg$variable=='group_biomasse'),], \n                  aes(x=as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                      y=as.numeric(gg$value[which(gg$variable=='group_biomasse')])))\n\nP_biomasse= P_biomasse + geom_line() + ylim(0,30) + xlim(0,15) +\n  ylab(\"Biomass (UVS)\") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n\n\n## Plot stateExploitation\nP_group_stateExploitation = ggplot(gg[which(gg$variable=='group_stateExploitation'),], \n                                   aes(x=as.numeric(gg$value[which(gg$variable=='subsession_round')]),\n                                       y=(as.numeric(gg$value[which(gg$variable=='group_stateExploitation')]))))\n\nP_group_stateExploitation = P_group_stateExploitation +  geom_point(size=1.8)+ geom_line() + \n  ylab(\"Harvest / MSY \") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n\n## Plot deviation from optimal path\n\nP_opt_prof_dev = ggplot(gg[which(gg$variable=='group_optProfDev'),], \n                        aes(x=factor(as.numeric(gg$value[which(gg$variable=='subsession_round')])),\n                            y=(as.numeric(gg$value[which(gg$variable=='group_optProfDev')])/3)))\n\nP_opt_prof_dev = P_opt_prof_dev + geom_bar(stat = \"identity\") +\n  ylab(\"Deviation from optimal profit path \") + xlab(\"Round (Year)\") +\n  theme_classic()+ theme(legend.text = element_text(colour=\"black\", size=10, face=\"bold\"))+ theme(legend.position=\"bottom\",\n                                                                                                  axis.title=element_text(size=8))\n\n\n##-------------------------------------\n##------------------------------------\n\nif (do.save==TRUE){jpeg(filename=paste(path.fig,\"T\",substr(names(nb_xp)[i], 4, 4),\"_phase\",substr(names(nb_xp)[i], 2, 2),\".jpg\",sep=\"\"),\n                        width = 2500, height = 2500,res = 300)}\n\ngrid.arrange(P_catch, P_profit , P_catchpledge, P_totalcatch, P_totalprofit , P_biomasse, P_meancatchpledge, P_meancatch,P_meanprofit,\n             P_group_stateExploitation,P_opt_prof_dev,\n             ncol=3, top = paste(\"T\",substr(names(nb_xp)[i], 4, 4),\" | phase:\",substr(names(nb_xp)[i], 2, 2),sep=\"\"))\n\nif (do.save==TRUE){dev.off()}\n\n##-------------------------------------\n##------------------------------------\nprint(paste(names(nb_xp)[i],'Efficacité: ',nb_xp[[i]]$group_efficiency[1],sep=\"\"))\nprint(\"#--------------------------------------------------------------------------#\")\nprint(paste(names(nb_xp)[i],'Deviation Moyenne: ',mean(nb_xp[[i]]$group_optProfDev,na.rm=T),sep=\"\"))\nprint(\"#--------------------------------------------------------------------------#\")\nprint(paste(names(nb_xp)[i],'Capture Moyenne: ',mean(nb_xp[[i]]$group_meancatch,na.rm=T),sep=\"\"))\nprint(paste(names(nb_xp)[i],'Profit Moyen: ',mean(nb_xp[[i]]$group_meanprofit,na.rm=T),sep=\"\"))\nprint(\"#--------------------------------------------------------------------------#\")\nprint(paste(names(nb_xp)[i],'Capture totale: ',sum(nb_xp[[i]]$player_catchchoice,na.rm=T),sep=\"\"))\nprint(paste(names(nb_xp)[i],'Profit total: ',sum(nb_xp[[i]]$player_profit,na.rm=T),sep=\"\"))\n\nprint(\"############################################################################\")\nprint(\"#--------------------------------------------------------------------------#\")\n\n}\n\n",
    "created" : 1481490921029.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2880852204",
    "id" : "641FB492",
    "lastKnownWriteTime" : 1481543214,
    "path" : "C:/Users/jselles/Dropbox/These/These_Ifremer/Documents_Travail/Modele_XP/XP_protocole/R_scripts/Get_Raw_Data_demoAERME.R",
    "project_path" : "Get_Raw_Data_demoAERME.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "type" : "r_source"
}